---
phase: 01-foundation-ghostty-module
plan: 04
type: execute
wave: 3
depends_on: ["01-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Ansible playbook runs without errors"
    - "Ghostty config symlinked to home directory"
    - "Module follows established patterns"
  artifacts:
    - path: "~/.config/ghostty/config"
      provides: "Symlink to module config"
      is_symlink: true
  key_links:
    - from: "~/.config/ghostty/config"
      to: "~/.dotmodules/ghostty/files/.config/ghostty/config"
      via: "GNU Stow symlink"
      pattern: "symlink"
---

<objective>
Deploy and verify the Ghostty module works correctly.

Purpose: Validate the module integrates properly with ansible-role-dotmodules and GNU Stow.
Output: Confirmed working deployment with symlinked Ghostty configuration.
</objective>

<execution_context>
@/Users/mcravey/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mcravey/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-ghostty-module/01-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Prepare for deployment and run playbook</name>
  <files></files>
  <action>
Handle potential stow conflicts and run deployment:

**Step 1: Handle existing config conflicts**
```bash
# Check if ~/.config/ghostty/config exists and is NOT a symlink
if [ -f ~/.config/ghostty/config ] && [ ! -L ~/.config/ghostty/config ]; then
  mv ~/.config/ghostty ~/.config/ghostty.backup.$(date +%Y%m%d)
  echo "Backed up existing config to ~/.config/ghostty.backup.*"
fi

# If it's already a symlink pointing elsewhere, remove it
if [ -L ~/.config/ghostty/config ]; then
  rm ~/.config/ghostty/config
  rmdir ~/.config/ghostty 2>/dev/null || true
fi
```

**Step 2: Run Ansible playbook**
```bash
cd /Users/mcravey/dotfiles
ansible-playbook -i playbooks/inventory playbooks/deploy.yml --skip-tags register_shell
```

Note: Using --skip-tags register_shell to avoid requiring sudo for shell registration.

The playbook will:
1. Process all modules in the install list
2. Install Ghostty via Homebrew cask (optional)
3. Use GNU Stow to symlink files from the ghostty module

Watch for:
- "ghostty" appearing in the output
- No stow conflicts or errors
- Successful completion message
  </action>
  <verify>
Run: `ls -la ~/.config/ghostty/config`
Should show symlink: ~/.config/ghostty/config -> ~/.dotmodules/ghostty/files/.config/ghostty/config
  </verify>
  <done>Ansible playbook completed successfully with Ghostty module deployed</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Ghostty terminal module deployed via Ansible playbook:
- Module structure at modules/ghostty/
- Configuration symlinked to ~/.config/ghostty/config
- Homebrew cask optionally installed Ghostty
  </what-built>
  <how-to-verify>
1. Verify the symlink exists:
   ```bash
   ls -la ~/.config/ghostty/config
   # Should show -> /Users/mcravey/.dotmodules/ghostty/files/.config/ghostty/config
   ```

2. If Ghostty is installed, open it and verify:
   - Theme is "Shades of Purple" (dark purple background #1e1e3f)
   - Font is MonoLisa Nerd Font at size 14
   - Window has padding and uses tabs titlebar style

3. Verify the module structure is correct:
   ```bash
   ls -la modules/ghostty/
   cat modules/ghostty/config.yml
   ```
  </how-to-verify>
  <resume-signal>Type "approved" if deployment is correct, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
After all tasks complete:
1. `ls -la ~/.config/ghostty/config` shows symlink to dotmodules
2. Symlink target exists and contains expected configuration
3. Human confirms deployment is correct
</verification>

<success_criteria>
- Ansible playbook runs without errors
- ~/.config/ghostty/config is a symlink to ~/.dotmodules/ghostty/files/.config/ghostty/config
- Human confirms deployment is correct
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-ghostty-module/01-04-SUMMARY.md`
</output>
