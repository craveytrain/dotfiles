# Codebase Structure

**Analysis Date:** 2026-01-23

## Directory Layout

```
dotfiles/
├── .claude/                 # Claude command definitions (auto-managed)
├── .cursor/                 # Cursor IDE configuration
├── .git/                    # Git repository metadata
├── .gitignore               # Git ignore rules
├── .planning/               # Planning documents and analysis
│   └── codebase/            # Codebase analysis documents (ARCHITECTURE.md, etc.)
├── .specify/                # Spec-Kit specifications (auto-managed)
├── ansible.cfg              # Ansible configuration
├── docs/                    # Project documentation and policy
│   └── policy/              # Governance and policy documents
│       ├── CONSTITUTION.md  # Project principles v1.0.0
│       ├── GOVERNANCE.md    # Governance model
│       ├── CODING_STANDARDS.md # Coding standards and conventions
│       └── CHANGELOG.md     # Project change history
├── modules/                 # Dotfile modules (primary content)
│   ├── 1password/           # 1Password CLI configuration
│   ├── dev-tools/           # Development utilities (mise, jq, shellcheck, etc.)
│   ├── editor/              # Vim configuration and plugins
│   ├── fish/                # Fish shell configuration
│   ├── fonts/               # System fonts for development
│   ├── git/                 # Git configuration and aliases
│   ├── merged/              # Auto-generated merged files from multiple modules
│   ├── node/                # Node.js development (via mise)
│   ├── shell/               # Common shell utilities (eza, ripgrep, tldr, etc.)
│   └── zsh/                 # Zsh shell configuration, prompt, and plugins
├── playbooks/               # Ansible playbook deployment automation
│   ├── deploy.yml           # Main deployment playbook
│   └── inventory            # Ansible inventory (localhost)
├── specs/                   # Feature specifications (spec-driven development)
├── CLAUDE.md                # Auto-generated development guidelines
├── CURSOR.md                # Cursor IDE instructions
├── .cursorrules             # Cursor-specific rules
├── QUICKSTART.md            # Quick start guide for new users
├── README.md                # Repository overview and documentation
├── requirements.yml         # Ansible Galaxy dependencies
└── [other root files]       # Git, license, and config files

```

## Directory Purposes

**`.planning/codebase/`:**
- Purpose: Generated codebase analysis documents (ARCHITECTURE.md, STRUCTURE.md, etc.)
- Contains: Markdown analysis files created by mapping tools
- Key files: None initially; populated by GSD mapping

**`docs/policy/`:**
- Purpose: Project governance, policies, and standards
- Contains: Constitutional documents, governance model, coding standards, changelog
- Key files: `CONSTITUTION.md`, `CODING_STANDARDS.md`

**`modules/`:**
- Purpose: Core dotfile modules for deployment
- Contains: 10 functional modules, each with `config.yml` and `files/`
- Each module follows standard structure:
  - `config.yml` - Module metadata (packages, stow dirs, mergeable files)
  - `files/` - Dotfiles organized in home directory structure
  - `README.md` - Module documentation

**`modules/merged/`:**
- Purpose: Auto-generated merged files from multiple module contributions
- Contains: Files that combine configuration from multiple modules
- Generated by: ansible-role-dotmodules during deployment
- Examples: `.zsh/aliases.sh` (merged from shell, zsh, editor), `.zshrc` (merged from zsh, dev-tools)

**`playbooks/`:**
- Purpose: Ansible deployment automation
- Contains: `deploy.yml` (main playbook) and `inventory` (localhost configuration)
- Key files: `deploy.yml` (orchestrates module installation), `inventory` (Ansible hosts file)

**`specs/`:**
- Purpose: Feature specifications for spec-driven development
- Contains: Spec folders like `001-ghostty-module/` with plan.md, spec.md, research.md
- Key files: Feature specifications created via Spec-Kit workflow

## Key File Locations

**Entry Points:**
- `playbooks/deploy.yml`: Main deployment orchestration (run via ansible-playbook)
- `modules/zsh/files/.zshrc`: Zsh shell entry point (symlinked to `~/.zshrc`)
- `modules/editor/files/.vimrc`: Vim configuration entry point (symlinked to `~/.vimrc`)
- `modules/git/files/.gitconfig`: Git configuration entry point (symlinked to `~/.gitconfig`)

**Configuration:**
- `ansible.cfg`: Ansible configuration (Python interpreter, deprecation warnings)
- `requirements.yml`: Ansible Galaxy role and collection requirements
- `modules/*/config.yml`: Per-module configuration defining packages and deployment strategy

**Core Logic:**
- `modules/shell/files/.zsh/environment.sh`: Shared shell environment (eza colors, aliases)
- `modules/zsh/files/.zsh/aliases.sh`: Zsh aliases (ip, catn, pubkey, mkdir, ls, etc.)
- `modules/zsh/files/.zsh/functions.sh`: Zsh utility functions (dataurl, headers, digg, rule, port, lanscan)
- `modules/editor/files/.vimrc`: Vim configuration (vim-plug bootstrap, plugin declarations, base settings)

**Shell Configuration Files:**
- `modules/zsh/files/.zshrc`: Main zsh configuration (plugin loading, sourcing, prompt initialization)
- `modules/zsh/files/.zsh/utility.zsh`: Additional zsh utilities (not explicitly shown but sourced)
- `modules/zsh/files/.zsh/environment.sh`: Merged environment variables (from shell, zsh, editor modules)
- `modules/zsh/files/.zsh/aliases.sh`: Merged aliases (from shell, zsh, editor modules)
- `modules/zsh/files/.zsh/functions.sh`: Zsh shell functions

**Testing:**
- No test files detected; project uses spec-driven development with Spec-Kit
- Test coverage via specification documents in `specs/` directory

**Documentation:**
- `README.md`: Main repository documentation with module list and usage instructions
- `QUICKSTART.md`: Quick start guide for new users
- `CURSOR.md`: Cursor IDE integration documentation
- `modules/*/README.md`: Per-module documentation explaining features and usage
- `docs/policy/CONSTITUTION.md`: Project principles and governance v1.0.0
- `docs/policy/CODING_STANDARDS.md`: Coding conventions

## Naming Conventions

**Files:**
- Dotfiles use standard Unix naming (`.zshrc`, `.gitconfig`, `.vimrc`, `.bashrc`)
- Configuration files use lowercase with hyphens: `config.yml`, `deploy.yml`
- Local override files use `.*.local` pattern: `.zshrc.local`, `.vimrc.local`, `.config/fish/config.local.fish`
- Specification files use numbered prefixes: `001-ghostty-module/`, `002-fix-stow-conflicts/`

**Directories:**
- Modules use lowercase with hyphens: `dev-tools`, `1password`, `editor`, `fish`, `git`, `node`, `shell`, `zsh`
- Hidden directory dotfiles: `.zsh`, `.config`, `.local`
- System directories: `playbooks/`, `modules/`, `docs/`, `specs/`

**Module Files:**
- Each module contains:
  - `config.yml` - Standard module configuration
  - `files/` - Directory containing dotfiles
  - `README.md` - Module documentation

## Where to Add New Code

**New Shell Function or Alias:**
- If shell-agnostic (works in both zsh and fish): `modules/shell/files/.zsh/environment.sh` (shell module)
- If Zsh-specific: `modules/zsh/files/.zsh/functions.sh` or `modules/zsh/files/.zsh/aliases.sh`
- If Fish-specific: `modules/fish/files/` (create `.config/fish/` structure)
- Note: If file is declared in `mergeable_files` in `config.yml`, multiple modules can contribute and they'll be merged

**New Vim Configuration:**
- Add to: `modules/editor/files/.vimrc`
- Plugin declarations: Use vim-plug syntax within `call plug#begin() / call plug#end()` block in `.vimrc`
- Local overrides: Users add to `~/.vimrc.local` (not tracked)

**New Module (e.g., New Tool or Language):**
- Create directory: `modules/new-tool-name/`
- Create files:
  - `modules/new-tool-name/config.yml` - Define Homebrew packages and stow_dirs
  - `modules/new-tool-name/files/` - Create home directory structure with dotfiles
  - `modules/new-tool-name/README.md` - Document the module
- Update playbook: Add module name to `dotmodules.install` list in `playbooks/deploy.yml`
- Example structure:
  ```yaml
  # config.yml
  homebrew_packages:
    - package-name
  stow_dirs:
    - new-tool-name
  mergeable_files:
    - '.zshrc'  # if this module contributes shell config
  ```

**New Homebrew Package:**
- Add to appropriate module's `config.yml` under `homebrew_packages:`
- Shell utilities (cross-shell): `modules/shell/config.yml`
- Zsh-specific: `modules/zsh/config.yml`
- Development tools: `modules/dev-tools/config.yml`
- Example: Add `- ripgrep-all` to `modules/dev-tools/config.yml` homebrew_packages list

**Mergeable Configuration:**
- If multiple modules need to contribute to same file (e.g., `.zshrc`, `.config/fish/config.fish`):
  - Add files with unique contributions to respective modules: `modules/module1/files/.zshrc`, `modules/module2/files/.zshrc`
  - Add to `mergeable_files:` list in each module's `config.yml`
  - ansible-role-dotmodules will merge with module attribution headers
  - Result stored in `modules/merged/` directory

**Machine-Specific Configuration:**
- Create `.*.local` files in home directory (not tracked)
- Examples: `~/.zshrc.local`, `~/.vimrc.local`, `~/.config/fish/config.local.fish`
- These are explicitly sourced by main configs if they exist

## Special Directories

**`modules/merged/`:**
- Purpose: Automatically generated merged files from multiple module contributions
- Generated: Yes (created by ansible-role-dotmodules during deployment)
- Committed: Yes (merged results are committed to track merging state)
- Content: Pre-merged files with module contribution headers

**`playbooks/`:**
- Purpose: Ansible automation for deployment
- Generated: No
- Committed: Yes
- Key file: `deploy.yml` orchestrates module installation via ansible-role-dotmodules role

**`.planning/codebase/`:**
- Purpose: Generated codebase analysis (created by GSD mapping tools)
- Generated: Yes
- Committed: Yes (analysis documents are useful for future development)
- Content: Architecture, structure, conventions, testing patterns, concerns

**`.specify/`:**
- Purpose: Spec-Kit workflow state (auto-managed)
- Generated: Yes
- Committed: Yes (workflow artifacts)
- Content: Spec-Kit operational state

**`.claude/` and `.cursor/`:**
- Purpose: IDE-specific configurations and commands (auto-managed)
- Generated: Yes (partially)
- Committed: Yes
- Content: Command definitions for Claude and Cursor integration

---

*Structure analysis: 2026-01-23*
